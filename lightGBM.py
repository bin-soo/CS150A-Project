from sklearn.model_selection import KFold,GroupKFold
from dataSeperation import sample3,trainx4,trainy4,trainxs,trainys
from sklearn.ensemble import RandomForestClassifier
import numpy as np
import pandas as pd
import lightgbm as gbm
def rmse(y1,y2):
    return np.sqrt(((y1 - y2) ** 2).mean())
trainx = trainxs
trainy = trainys
lgbm = gbm.LGBMClassifier(boosting_type = 'gbdt', objective='binary', max_depth=5, num_leaves = 45, learning_rate=0.15, n_estimators=825, n_jobs=4,
                         min_child_weight=1, seed=42, subsample=0.85, subsample_freq = 1, boost_from_average = False, reg_lambda = 0.12)
rmseList = []
for kfold, (train, val) in enumerate(KFold(n_splits=5,shuffle=True,random_state=42)\
                                              .split(trainx, trainy)):

    X_train, X_val = trainx.iloc[train], trainx.iloc[val]
    y_train, y_val = trainy.iloc[train], trainy.iloc[val]
    lgbm.fit(X_train,y_train)
    y_pred = lgbm.predict_proba(X_val)
    pred = y_pred[:,1]
    print(pred)
    print(pred.shape)
    rmseList.append(rmse(pred,y_val))
print('rmse of val: ',rmseList,'\nmean: ',np.mean(rmseList))

'''
n = 300, lr = 0.08, depth = 5:
rmse of val:  [0.3559166920013514, 0.35734895683093776, 0.3588461908007403, 0.3575335236367929, 0.3528417851410494] 
mean:  0.35649742968217435

on sample s:
rmse of val:  [0.3497693321701627, 0.3473746597287868, 0.3479416654365751, 0.34837133143416604, 0.3494885287580998] 
mean:  0.34858910350555805
-----
n = 300, lr = 0.1, depth = 5:
rmse of val:  [0.35685672113496325, 0.3587061077808856, 0.3607680583827991, 0.3579740703276941, 0.35410656529477524] 
mean:  0.35768230458422345

n = 300 learning_rate = 0.08 max_depth = 5
rmse of val:  [0.3497693321701627, 0.3473746597287868, 0.3479416654365751, 0.34837133143416604, 0.3494885287580998]
mean:  0.34858910350555805 

300 0.15 5 
rmse of val:  [0.34765589729298424, 0.3451627039455062, 0.3457815044523106, 0.34617640240165365, 0.34782340632777636]
mean:  0.34651998288404623

300 0.2 5 
rmse of val:  [0.34718688564628564, 0.3440264998297763, 0.34521699995350663, 0.346639747624294, 0.3468313396890862]
mean:  0.34598029454858975

300 0.05 5 
rmse of val:  [0.35239175002433, 0.3497547052044666, 0.35012203433377104, 0.3505509316008821, 0.3517419572724827]
mean:  0.35091227568718647

300 0.1 5
rmse of val:  [0.3489957500677585, 0.34652451199588086, 0.34713460346495073, 0.3475595812160744, 0.3485828846765997]
mean:  0.3477594662842528

300 0.25 5
rmse of val:  [0.34752486448744785, 0.34449259193175147, 0.34563254435856083, 0.34597677815810673, 0.3475318322712867]
mean:  0.34623172224143073

500 0.25 5
rmse of val:  [0.34726067298063273, 0.3438389225741018, 0.34468884690172447, 0.345941298711981, 0.346996998367991]
mean:  0.34574534790728617

500 0.25 7
rmse of val:  [0.34802590937312217, 0.3447940577154702, 0.34627647590746824, 0.34688780198811936, 0.34737764948077343]
mean:  0.3466723788929907

500 0.25 3
rmse of val:  [0.35023726325387045, 0.3480551734575671, 0.34853826418508493, 0.3492104700252181, 0.3497792976482993]
mean:  0.349164093714008

500 0.25 4
rmse of val:  [0.3474146079465869, 0.34493849659331044, 0.34562830867610533, 0.347092634786778, 0.3475795253913264]
mean:  0.34653071467882146

500 0.25 6
rmse of val:  [0.3474696484833439, 0.34461434309363737, 0.3456579845407594, 0.3465231319669881, 0.34712700020910575]
mean:  0.34627842165876693

750 0.25 5
rmse of val:  [0.3478915467735622, 0.34394476726649476, 0.34490226024299125, 0.34624300221898685, 0.3475780352973843]
mean:  0.34611192235988386

500 0.3 5
rmse of val:  [0.3478390206538669, 0.34484470722010907, 0.34619425909700186, 0.346583643040552, 0.3483634958667924]
mean:  0.3467650251756644

500 0.2 5
rmse of val:  [0.34642911026011125, 0.34367606728132055, 0.3440206142437518, 0.34594146588284364, 0.34621102045769486]
mean:  0.34525565562514443

500 0.16 5
rmse of val:  [0.34605719570374593, 0.34377384184027915, 0.34420805187816206, 0.34547955769763833, 0.3459921179844873]
mean:  0.34510215302086256

500 0.12 5
rmse of val:  [0.3465841701009916, 0.3442743354204105, 0.34429920908871087, 0.3451963773317027, 0.3461456418830962]
mean:  0.3452999467649823

500 0.14 5
rmse of val:  [0.34659782203698636, 0.3440152095322236, 0.34381725963834564, 0.3453318663343983, 0.3456024538914246]
mean:  0.3450729222866757

500 0.15 5
rmse of val:  [0.3458947426453063, 0.3437673948193546, 0.3441114114267422, 0.3447894478436208, 0.3460365286294328]
mean:  0.3449199050728914

600 0.15 5
rmse of val:  [0.3455405449747616, 0.34308107590690134, 0.3439523989789534, 0.3445768968925522, 0.3455667397695053]
mean:  0.34454353130453474

650 0.15 5
rmse of val:  [0.34549453529970403, 0.34275166857046974, 0.3438030204888013, 0.3445249369492806, 0.3453884150730197]
mean:  0.34439251527625514

750 0.15 5
rmse of val:  [0.3453918711974436, 0.34284334532211186, 0.3436629616948572, 0.34451437710416766, 0.34531216254013886]
mean:  0.34434494357174383

780 0.15 5
rmse of val:  [0.34536176089941545, 0.34282605277289135, 0.34357307177455193, 0.3445298385672969, 0.3453667753790142]
mean:  0.344331499878634

800 0.15 5
rmse of val:  [0.34531542870322884, 0.3428160672034194, 0.34362720874285746, 0.34450621339087634, 0.3452417296317967]
mean:  0.34430132953443576

825 0.15 5
rmse of val:  [0.3454252696873607, 0.34282548281967107, 0.3435211841836807, 0.34450129876310226, 0.34527369154875165]
mean:  0.34430938540051326

900 0.15 5
rmse of val:  [0.34543626353432255, 0.34281575883982507, 0.34370936740225744, 0.3447162746685242, 0.3454924305760072]
mean:  0.3444340190041873

1000 0.15 5
rmse of val:  [0.34536895060044087, 0.3427977312745677, 0.3437426165002521, 0.3448114156348084, 0.3454945545198167]
mean:  0.34444305370597716
'''