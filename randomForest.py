from sklearn.model_selection import KFold,GroupKFold
from dataSeperation import sample3,trainx3,trainy3,trainxs,trainys
from sklearn.ensemble import RandomForestClassifier
import numpy as np
import pandas as pd
def rmse(y1,y2):
    return np.sqrt(((y1 - y2) ** 2).mean())
trainx = trainx3
trainy = trainy3
rf = RandomForestClassifier(n_estimators=2500, criterion='gini', max_depth=20, min_samples_split=.01, n_jobs=4,
                            random_state=42)
rmseList = []
for kfold, (train, val) in enumerate(KFold(n_splits=5,shuffle=True,random_state=42)\
                                              .split(trainx, trainy)):

    X_train, X_val = trainx.iloc[train], trainx.iloc[val]
    y_train, y_val = trainy.iloc[train], trainy.iloc[val]
    rf.fit(X_train,y_train)
    y_pred = rf.predict_proba(X_val)
    pred = y_pred[:,1]
    print(pred)
    print(pred.shape)
    rmseList.append(rmse(pred,y_val))
print('rmse of val: ',rmseList,'\n mean: ',np.mean(rmseList))

'''
n = 300:
rmse of val:  [0.3581938070589848, 0.3561131152779164, 0.35921866359291854, 0.35509526562366606, 0.3655570216884372]
mean:  0.3588355746483846

'''
'''
origin n 300 mean 0.35884
n 400 mean 0.35886
n 1200 mean 0.35883
n 300 maxdepth 20 mean 0.35885
n 300 maxdepth 50 mean 0.35884
n 300 maxdepth 75 mean 0.35884 same to n = 50
n 500 maxdepth 75 mean 0.35886
n 500 maxdepth 50 mean 0.35886 same to n = 75
n 500 maxdepth 20 mean 0.35886 bigger than n = 50
n 500 maxdepth 20 mean 0.35883
n 150 maxdepth 20 mean 0.35895

500 None:
rmse of val:  [0.3583217185939921, 0.3559557254703027, 0.3593642137497724, 0.3551895614396369, 0.36545157405071355]
 mean:  0.3588565586608835
 
1000 50
rmse of val:  [0.3583227109839548, 0.35599561144713165, 0.35933519107408846, 0.35515361072468266, 0.36545525652738775]
 mean:  0.3588524761514491
 
 1200 50
 rmse of val:  [0.3583034785623226, 0.3559520360273083, 0.3593099345798821, 0.355163052564808, 0.36541440535963027]
 mean:  0.35882858141879026  slow
 
 1500 50
 rmse of val:  [0.35828950372745666, 0.3559707466030947, 0.35926484319069074, 0.35515955919713754, 0.365419241221999]
 mean:  0.35882077878807567
 
 1500 75
 rmse of val:  [0.35828950372745666, 0.35597074660309475, 0.35926484319069074, 0.3551595591971375, 0.3654192412219989]
 mean:  0.3588207787880757
 
 2000 75
 rmse of val:  [0.35827158568284134, 0.3559710406779706, 0.3592630839403213, 0.3551402578582076, 0.3654388088252374]
 mean:  0.3588169553969156
 
 2000 100 really slow
 rmse of val:  [0.35827158568284134, 0.3559710406779706, 0.3592630839403213, 0.3551402578582076, 0.3654388088252374]
 mean:  0.3588169553969156
 
 2000 50
 rmse of val:  [0.35827158568284134, 0.3559710406779706, 0.3592630839403213, 0.3551402578582076, 0.36543880882523744]
 mean:  0.3588169553969156
 
 2000 25
 rmse of val:  [0.35827178884609817, 0.35596640061804247, 0.3592661963153671, 0.35513954913555834, 0.36543600909585716]
 mean:  0.3588159888021846
 
 2000 22
 rmse of val:  [0.3582613585590343, 0.3559766107507993, 0.35925590303767047, 0.355149705975361, 0.36544155450874155]
 mean:  0.3588170265663213
 
 2000 20
 rmse of val:  [0.35827578656265074, 0.3559785229991846, 0.3592536613397218, 0.3551323125088957, 0.36543626810386215]
 mean:  0.35881531030286296
 
 2000 18
 rmse of val:  [0.3582457887804602, 0.35602073606894047, 0.35926867911271054, 0.35512027629620635, 0.36548492138590394]
 mean:  0.3588280803288443
 
 2000 15
 rmse of val:  [0.3583556819467961, 0.356083917216129, 0.3594258383726734, 0.35522120028923937, 0.3656424243744798]
 mean:  0.35894581243986357
 
 2000 12
 rmse of val:  [0.3587522386961278, 0.35662893197832723, 0.3597253293231918, 0.3555564239238887, 0.3661393051915232]
 mean:  0.35936044582261173
 
 1000 25
 rmse of val:  [0.3583227925303949, 0.35599048423627144, 0.3593318254528296, 0.35515134311469193, 0.3654542953534178]
 mean:  0.35885014813752114
 
 1000 30
 rmse of val:  [0.3583224404369818, 0.3559962096205212, 0.3593350777553586, 0.35515361072468266, 0.36545550580302416]
 mean:  0.3588525688681137
 
 2400 20
 rmse of val:  [0.35828622796512416, 0.35594749826406474, 0.3592633677888443, 0.3551239314926825, 0.36541632570163496]
 mean:  0.3588074702424702
 
 2500 20
 rmse of val:  [0.35829644319558257, 0.3559626538502145, 0.35925818696393336, 0.35512770301431595, 0.3654232670845031]
 mean:  0.3588136508217099
 
 3000 20
 rmse of val:  [0.35828063775755636, 0.35595139490132877, 0.3592765947987468, 0.35513115067159445, 0.36541631292819804]
 mean:  0.3588112182114849
 
 2700 20
 rmse of val:  [0.3582853889278338, 0.35596452594710953, 0.3592624723340329, 0.3551372565482272, 0.3654183242339793]
 mean:  0.3588135935982365
'''
